<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/exampleLayout}">

<!-- ì‚¬ìš©ì CSS -->
<th:block layout:fragment="css">
  <style>
    .error {
      color: red;
      font-weight: bold;
    }
  </style>
</th:block>

<div layout:fragment="content" class="container mt-5" style="max-width: 500px;">
  <h2 class="text-center mb-4">ë¡œê·¸ì¸</h2>

  <th:block th:if="${message != null}">
    <script th:inline="javascript">
      alert([[${message}]]);
    </script>
  </th:block>

  <form id="loginForm" method="post" th:action="@{/member/memberLogin}">
    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

    <div class="form-group mb-3">
      <label for="mid">ì•„ì´ë””</label>
      <input type="text" id="mid" name="mid" class="form-control" placeholder="ì•„ì´ë””ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”" required>
    </div>

    <div class="form-group mb-3">
      <label for="password">ë¹„ë°€ë²ˆí˜¸</label>
      <input type="password" id="password" name="password" class="form-control" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥" required>
    </div>

    <div class="form-check mb-3">
      <input class="form-check-input" type="checkbox" id="rememberMe">
      <label class="form-check-label" for="rememberMe">ì•„ì´ë”” ê¸°ì–µí•˜ê¸°</label>
    </div>

    <div class="mb-3">
      <p th:if="${loginErrorMsg}" class="error" th:text="${loginErrorMsg}"></p>
      <button type="submit" class="btn btn-success w-100">ë¡œê·¸ì¸</button>
      <button type="button" class="btn btn-secondary w-100 mt-2" onclick="location.href='/member/memberJoin'">íšŒì›ê°€ì…</button>
    </div>
  </form>
</div>
<script>
  window.addEventListener("load", function () {
    console.log("ğŸ”¥ window loaded");

    const savedId = localStorage.getItem("savedId");
    if (savedId) {
      console.log("âœ… ì €ì¥ëœ ì•„ì´ë”” ìˆìŒ:", savedId);
      document.getElementById("mid").value = savedId;
      document.getElementById("rememberMe").checked = true;
    }

    const form = document.getElementById("loginForm");
    if (form) {
      console.log("âœ… í¼ ì°¾ìŒ");
      form.addEventListener("submit", function (e) {
        e.preventDefault();
        const remember = document.getElementById("rememberMe").checked;
        const userId = document.getElementById("mid").value;

        if (remember) {
          console.log("ğŸ’¾ ì•„ì´ë”” ì €ì¥í•¨:", userId);
          localStorage.setItem("savedId", userId);
        } else {
          console.log("ğŸ—‘ï¸ ì•„ì´ë”” ì‚­ì œí•¨");
          localStorage.removeItem("savedId");
        }

        setTimeout(() => {
          console.log("ğŸš€ í¼ ì‹¤ì œ ì œì¶œ");
          form.submit();
        }, 100);
      });
    } else {
      console.log("âŒ í¼ ëª» ì°¾ìŒ");
    }
  });
</script>
</html>
