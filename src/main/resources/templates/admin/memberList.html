<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/exampleLayout}">

<!-- CSS ì˜ì—­ -->
<th:block layout:fragment="css">
    <style>
        html, body {
          height: 100%;
          margin: 0;
          padding: 0;
        }

        .page-wrapper {
          min-height: 100vh;
          display: flex;
          flex-direction: column;
        }

        .container {
          flex: 1;
        }

        footer {
          margin-top: auto;
        }

        .search-box {
          background: #f8f9fa;
          padding: 20px;
          border-radius: 12px;
          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
          margin-bottom: 30px;
        }

        .search-box .form-select,
        .search-box .form-control {
          border-radius: 8px;
        }

        .search-box .btn {
          border-radius: 8px;
        }

        .btn-sm {
          padding: 6px 12px;
          font-size: 0.875rem;
        }
    </style>
</th:block>

<!-- ì½˜í…ì¸  ì˜ì—­ -->
<div layout:fragment="content" class="page-wrapper">
    <div class="container mt-5">
        <h2 class="mb-4">íšŒì› ê´€ë¦¬</h2>

        <!-- ğŸ” ê²€ìƒ‰ í¼ -->
        <form th:action="@{/admin/member}" method="get" class="row search-box">
            <div class="col-auto">
                <select name="role" class="form-select">
                    <option value="">ì „ì²´</option>
                    <option value="PENDING" th:selected="${role} == 'PENDING'">ê°€ì… ìš”ì²­</option>
                    <option value="WITHDRAWN" th:selected="${role} == 'WITHDRAWN'">íƒˆí‡´ ìš”ì²­</option>
                    <option value="USER" th:selected="${role} == 'USER'">ì¼ë°˜ íšŒì›</option>
                </select>
            </div>

            <div class="col-auto">
                <select name="category" class="form-select">
                    <option value="mid" th:selected="${category} == 'mid'">ì•„ì´ë””</option>
                    <option value="username" th:selected="${category} == 'username'">ì´ë¦„</option>
                    <option value="company" th:selected="${category} == 'company'">ì†Œì† ê¸°ì—…</option>
                </select>
            </div>

            <div class="col-auto">
                <input type="text" name="keyword" class="form-control" placeholder="ê²€ìƒ‰ì–´ ì…ë ¥" th:value="${keyword}" />
            </div>

            <div class="col-auto">
                <button type="submit" class="btn btn-outline-primary">ê²€ìƒ‰</button>
            </div>
        </form>

        <!-- ğŸ“‹ íšŒì› ë¦¬ìŠ¤íŠ¸ + ì¼ê´„ ì²˜ë¦¬ -->
        <form method="post" th:action="@{/admin/bulkAction}">
            <table class="table table-bordered text-center align-middle">
                <thead class="table-light">
                <tr>
                    <th><input type="checkbox" onclick="toggleAll(this)" /></th>
                    <th>ë²ˆí˜¸</th>
                    <th>ì•„ì´ë””</th>
                    <th>ì´ë¦„</th>
                    <th>ì†Œì† ê¸°ì—…</th>
                    <th>ì´ë©”ì¼</th>
                    <th>ì „í™”ë²ˆí˜¸</th>
                    <th>ìƒíƒœ</th>
                    <th>íƒˆí‡´ì‹ ì²­ì¼</th>
                    <th>ê²½ê³¼ì¼</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="member, stat : ${memberList}">
                    <td>
                        <input type="checkbox" name="memberIds"
                               th:value="${member.idx}"
                               th:if="${member.role.name() == 'PENDING' or member.role.name() == 'WITHDRAWN'}"/>
                    </td>
                    <td th:text="${stat.index + 1}"></td>
                    <td th:text="${member.mid}"></td>
                    <td th:text="${member.username}"></td>
                    <td th:text="${member.company != null ? member.company.name : 'ë¯¸ì§€ì •'}"></td>
                    <td th:text="${member.email}"></td>
                    <td th:text="${member.tel}"></td>
                    <td th:text="${member.role}"></td>
                    <td th:text="${member.quitRequestedAt != null ? #temporals.format(member.quitRequestedAt, 'yyyy-MM-dd') : ''}"></td>
                    <td th:text="${member.quitRequestedAt != null ? T(java.time.temporal.ChronoUnit).DAYS.between(member.quitRequestedAt.toLocalDate(), T(java.time.LocalDate).now()) + 'ì¼' : ''}"></td>
                </tr>
                </tbody>
            </table>

            <div class="d-flex justify-content-end gap-2 mt-3">
                <button type="submit" name="action" value="approve" class="btn btn-success btn-sm">ì„ íƒ íšŒì› ìŠ¹ì¸</button>
            </div>
        </form>

        <th:block th:if="${message != null}">
            <script th:inline="javascript">
                alert([[${message}]]);
            </script>
        </th:block>

        <script>
            function toggleAll(source) {
              const checkboxes = document.querySelectorAll("input[name='memberIds']");
              checkboxes.forEach(cb => cb.checked = source.checked);
            }
        </script>
    </div>
</div>
</html>
